---
import "../styles/global.css";
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
const { title = "派小站" } = Astro.props;
---

<html lang="zh" class="scroll-smooth">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>{title}</title>
    </head>
    <body class="bg-slate-50 text-slate-900 antialiased font-sans selection:bg-blue-100 selection:text-blue-700 relative">
        <div class="fixed inset-0 -z-20 overflow-hidden">
            <img
                src="/bg.png"
                class="w-full h-full object-cover opacity-[0.35] filter"
                alt="网页背景"
            />
            <!-- 更透明的遮罩层，让背景更明亮 -->
            <div class="absolute inset-0 bg-linear-to-tr from-white/40 via-transparent to-white/30"></div>
        </div>

        <div class="fixed inset-0 -z-10 pointer-events-none">
            <div class="absolute top-[-10%] right-[-10%] w-[50%] h-[50%] bg-blue-100/30 blur-[120px] rounded-full"></div>
        </div>

        <header class="sticky top-0 z-50 bg-white/70 backdrop-blur-xl border-b border-slate-200/50">
            <div class="max-w-5xl mx-auto px-8">
                <Nav />
            </div>
        </header>

        <main class="max-w-5xl mx-auto px-4 py-4 min-h-[calc(100vh-80px)]">
            <slot />
        </main>

        <footer class="bg-white/80 backdrop-blur-md border-t border-slate-200">
            <div class="max-w-5xl mx-auto px-4 py-4">
                <Footer />
            </div>
        </footer>

        <!-- 回到顶部按钮 - 带圆形进度条 -->
        <button
            id="back-to-top"
            aria-label="回到顶部"
            class="fixed bottom-8 right-8 w-14 h-14 bg-white border-2 border-slate-200 rounded-full shadow-xl flex items-center justify-center hover:border-blue-500 hover:shadow-2xl hover:scale-110 transition-all duration-300 opacity-0 invisible z-100 group"
            style="right: 2rem !important; bottom: 2rem !important;"
        >
            <svg class="absolute w-full h-full -rotate-90" viewBox="0 0 56 56">
                <!-- 背景圆环 -->
                <circle
                    cx="28"
                    cy="28"
                    r="24"
                    fill="none"
                    stroke="#e2e8f0"
                    stroke-width="3"
                />
                <!-- 进度圆环 -->
                <circle
                    id="progress-circle"
                    cx="28"
                    cy="28"
                    r="24"
                    fill="none"
                    stroke="url(#gradient)"
                    stroke-width="3"
                    stroke-linecap="round"
                    stroke-dasharray="150.79"
                    stroke-dashoffset="150.79"
                    class="transition-all duration-150 ease-out"
                />
                <!-- 渐变定义 -->
                <defs>
                    <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                        <stop offset="0%" stop-color="#3b82f6" />
                        <stop offset="100%" stop-color="#06b6d4" />
                    </linearGradient>
                </defs>
            </svg>
            <!-- 中心箭头图标 -->
            <svg class="w-6 h-6 text-slate-600 group-hover:text-blue-600 transition-colors duration-300 relative z-10" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="3">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 15.75l7.5-7.5 7.5 7.5" />
            </svg>
        </button>

        <script>
            const backToTopBtn = document.getElementById('back-to-top');
            const progressCircle = document.getElementById('progress-circle');
            const circumference = 2 * Math.PI * 24; // 2πr，r=24

            // 更新进度条
            const updateProgress = () => {
                const scrollTop = window.scrollY;
                const docHeight = document.documentElement.scrollHeight - window.innerHeight;
                const scrollPercent = Math.min(scrollTop / docHeight, 1);
                const offset = circumference - (scrollPercent * circumference);

                // 更新进度圆环
                if (progressCircle) {
                    progressCircle.style.strokeDashoffset = offset.toString();
                }

                // 控制按钮显示/隐藏（降低阈值为 50px）
                if (scrollTop > 50) {
                    backToTopBtn?.classList.remove('opacity-0', 'invisible');
                    backToTopBtn?.classList.add('opacity-100', 'visible');
                } else {
                    backToTopBtn?.classList.add('opacity-0', 'invisible');
                    backToTopBtn?.classList.remove('opacity-100', 'visible');
                }
            };

            // 监听滚动事件
            window.addEventListener('scroll', updateProgress);
            // 初始化进度
            updateProgress();

            // 点击按钮平滑滚动到顶部
            backToTopBtn?.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
                // 进度条会在滚动过程中通过 scroll 事件自动更新
            });
        </script>
    </body>
</html>